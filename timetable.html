    });
    topInputEl.addEventListener("change", (e) => {
        setPiPTopColor(e.target.value);
        drawPiP(mainLine.textContent, subLine.textContent);
    });
}
if (bottomInputEl) {
    bottomInputEl.addEventListener("input", (e) => {
        setPiPBottomColor(e.target.value);
        drawPiP(mainLine.textContent, subLine.textContent);
    });
    bottomInputEl.addEventListener("change", (e) => {
        setPiPBottomColor(e.target.value);
        drawPiP(mainLine.textContent, subLine.textContent);
    });
}


// allow entering PiP on body click (best-effort)
document.body.addEventListener("click", async (ev) => {
    // if clicking inside settings modal we don't open PiP
    if (settingsModal.contains(ev.target)) return;
    try {
        // ensure keep-alive is running while PiP may be open
        startPiPKeepAlive();
        await video.requestPictureInPicture();
    } catch (e) { /* ignore if unavailable */ }
});


// initial preview while app starts
initialPreview();


// export preview canvas to hidden PiP capture periodically so preview remains in sync
// draw initial immediately:
drawPiP("Loading...", "Preparing preview");


// Initial UI + loop
updateWeekToggleUI();
update();
setInterval(update, 1000);


// Keep updating preview canvas (so the tiny visible preview updates smoothly)
setInterval(() => {
    // keep preview in sync with main canvas (drawPiP already copies to preview)
    try {
        previewCtx.clearRect(0,0,previewCanvas.width, previewCanvas.height);
        previewCtx.drawImage(canvas, 0, 0, previewCanvas.width, previewCanvas.height);
    } catch (e) {}
}, 700);


// start keep-alive so captureStream has frames even when text unchanged
startPiPKeepAlive();


</script>


</body>
</html>
